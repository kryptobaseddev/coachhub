import{a as p,t as y,c as Ve,b as Ze}from"../chunks/disclose-version.CJFPsRL-.js";import{p as Fe,c as a,r as t,s as l,n as Pe,t as _,a as Me,g as e,i as S,f as pe,h as qe,l as ze,b as Be,m as me,d as m,j as He}from"../chunks/runtime.CUNFE6o5.js";import{e as T,s as x}from"../chunks/render.YXdxLiCJ.js";import{p as je,i as Q}from"../chunks/props.D6-fppJ3.js";import{e as K,i as le}from"../chunks/Icon.Bvhz2f0e.js";import{c as Je}from"../chunks/svelte-component.CIsdkGy0.js";import{i as Le}from"../chunks/lifecycle.CDJD4jvc.js";import{s as Xe,a as Ge}from"../chunks/store.BcJSs_Hw.js";import{i as Ke}from"../chunks/demoMode.ClaLBl7d.js";import{g as Qe,r as X,s as G}from"../chunks/index.CnPSb7tb.js";import{b as ie,c as Re}from"../chunks/input.BTYOOzm3.js";import{b as Ce}from"../chunks/select.C4s-v16H.js";import{p as We}from"../chunks/event-modifiers.CWmzcjye.js";import{c as Ye}from"../chunks/index-client.Cowl8BPV.js";import{X as et,P as tt,M as at,C as rt,a as st,b as lt,c as it}from"../chunks/x.CZYS9xFn.js";import{Z as ot}from"../chunks/zap.BJIn6b88.js";import{S as nt}from"../chunks/settings.BuYUDVRY.js";import{T as dt}from"../chunks/trash-2.dVfbSBcP.js";var vt=y('<label class="flex items-center"><input type="checkbox" class="rounded border-gray-300 text-blue-600"> <span class="ml-2 text-sm text-gray-700 capitalize"> </span></label>'),ut=y("<option> </option>"),ct=y("<option> </option>"),mt=y("<option> </option>"),pt=y('<input type="range" class="flex-1"> <span class="text-sm text-gray-600 w-16"> </span>',1),bt=y('<input type="number" class="block w-full rounded-md border-gray-300 shadow-sm"> <span class="text-sm text-gray-600"> </span>',1),ft=y('<div class="col-span-3 mt-2"><label for="automation-value" class="block text-sm font-medium text-gray-700">Value</label> <div class="flex items-center space-x-2"><!></div></div>'),gt=y('<div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg"><div class="flex-1 grid grid-cols-3 gap-4"><div><label for="automation-device-type" class="block text-sm font-medium text-gray-700">Device Type</label> <select id="automation-device-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select></div> <div><label for="automation-target" class="block text-sm font-medium text-gray-700">Target</label> <select id="automation-target" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select></div> <div><label for="automation-action" class="block text-sm font-medium text-gray-700">Action</label> <select id="automation-action" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select></div> <!></div> <button type="button" class="p-2 text-red-600 hover:text-red-800 rounded-full hover:bg-red-50"><!></button></div>'),_t=y('<div class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center"><div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto"><div class="px-4 py-5 sm:px-6 border-b flex justify-between items-center"><h3 class="text-lg font-medium text-gray-900"> </h3> <button class="rounded-full p-1 hover:bg-gray-100"><!></button></div> <form class="p-6 space-y-6"><div class="space-y-4"><div><label for="automation-name" class="block text-sm font-medium text-gray-700">Name</label> <input id="automation-name" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required></div> <div><label for="automation-description" class="block text-sm font-medium text-gray-700">Description</label> <input id="automation-description" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div></div> <div class="space-y-4"><h4 class="font-medium text-gray-900">Trigger</h4> <div><label for="automation-time" class="block text-sm font-medium text-gray-700">Time</label> <input id="automation-time" type="time" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required></div> <div><label for="automation-days" class="block text-sm font-medium text-gray-700 mb-2">Days</label> <div class="space-y-2"></div></div></div> <div class="space-y-4"><div class="flex justify-between items-center"><h4 class="font-medium text-gray-900">Actions</h4> <button type="button" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200"><!> Add Action</button></div> <div class="space-y-4"></div> <div class="mt-6 flex justify-end space-x-3"><button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button> <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> </button></div></div></form></div></div>');function xt(be,U){Fe(U,!1);const fe=[];let i=je(U,"automation",28,()=>({id:null,name:"",description:"",isEnabled:!0,trigger:{type:"schedule",time:"12:00",days:[]},actions:[]})),v=je(U,"availableDevices",8);const $=Ye(),oe=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],C=[{value:"lights",label:"Lights"},{value:"climate",label:"Climate Control"},{value:"shades",label:"Shades"},{value:"floor_heat",label:"Heated Floors"}];function j(){i(i().actions=[...i().actions,{type:"lights",target:"all",action:"off"}],!0)}function ge(n){i(i().actions=i().actions.filter((s,k)=>k!==n),!0)}function _e(n){switch(n){case"lights":return[{value:"all",label:"All Lights"},...v().interior.lights.map(s=>({value:s.id,label:s.name}))];case"climate":return v().climate.thermostats.map(s=>({value:s.id,label:s.name}));case"shades":return[{value:"all",label:"All Shades"},...v().interior.shades.map(s=>({value:s.id,label:s.name}))];case"floor_heat":return v().climate.heatedFloors.map(s=>({value:s.id,label:s.name}));default:return[]}}function xe(n){switch(n){case"lights":return[{value:"on",label:"Turn On"},{value:"off",label:"Turn Off"},{value:"set",label:"Set Brightness"}];case"climate":return[{value:"set",label:"Set Temperature"},{value:"off",label:"Turn Off"}];case"shades":return[{value:"open",label:"Open"},{value:"close",label:"Close"},{value:"set",label:"Set Position"}];case"floor_heat":return[{value:"on",label:"Turn On"},{value:"off",label:"Turn Off"},{value:"set",label:"Set Temperature"}];default:return[]}}function ye(){$("save",i())}function he(n){switch(n.type){case"lights":return n.action==="set"?{type:"range",min:0,max:100,step:1,unit:"%"}:null;case"climate":return n.action==="set"?{type:"number",min:60,max:85,step:1,unit:"°F"}:null;case"shades":return n.action==="set"?{type:"range",min:0,max:100,step:1,unit:"%"}:null;case"floor_heat":return n.action==="set"?{type:"number",min:65,max:85,step:1,unit:"°F"}:null;default:return null}}Qe(),Le();var V=_t(),Z=a(V),O=a(Z),R=a(O),W=a(R);t(R);var F=l(R,2),we=a(F);et(we,{class:"h-5 w-5 text-gray-400"}),t(F),t(O);var z=l(O,2),Y=a(z),d=a(Y),r=l(a(d),2);X(r),t(d);var b=l(d,2),P=l(a(b),2);X(P),t(b),t(Y);var M=l(Y,2),q=l(a(M),2),B=l(a(q),2);X(B),t(q);var ne=l(q,2),H=l(a(ne),2);K(H,5,()=>oe,le,(n,s)=>{var k=vt(),c=a(k);X(c);var E,h=l(c,2),N=a(h);t(h),t(k),_(()=>{E!==(E=e(s))&&(c.value=(c.__value=e(s))==null?"":e(s)),x(N,e(s))}),Re(fe,[],c,()=>(e(s),i().trigger.days),A=>i(i().trigger.days=A,!0)),p(n,k)}),t(H),t(ne),t(M);var de=l(M,2),J=a(de),L=l(a(J),2),ve=a(L);tt(ve,{class:"h-4 w-4 mr-1"}),Pe(),t(L),t(J);var ee=l(J,2);K(ee,5,()=>i().actions,le,(n,s,k)=>{var c=gt(),E=a(c),h=a(E),N=l(a(h),2);_(()=>{e(s).type,S(()=>{})}),K(N,5,()=>C,le,(f,u)=>{var o=ut(),w={},I=a(o);t(o),_(()=>{w!==(w=e(u).value)&&(o.value=(o.__value=e(u).value)==null?"":e(u).value),x(I,e(u).label)}),p(f,o)}),t(N),t(h);var A=l(h,2),D=l(a(A),2);_(()=>{e(s).target,S(()=>{})}),K(D,5,()=>_e(e(s).type),le,(f,u)=>{var o=ct(),w={},I=a(o);t(o),_(()=>{w!==(w=e(u).value)&&(o.value=(o.__value=e(u).value)==null?"":e(u).value),x(I,e(u).label)}),p(f,o)}),t(D),t(A);var ke=l(A,2),Ae=l(a(ke),2);_(()=>{e(s).action,S(()=>{})}),K(Ae,5,()=>xe(e(s).type),le,(f,u)=>{var o=mt(),w={},I=a(o);t(o),_(()=>{w!==(w=e(u).value)&&(o.value=(o.__value=e(u).value)==null?"":e(u).value),x(I,e(u).label)}),p(f,o)}),t(Ae),t(ke);var Ne=l(ke,2);Q(Ne,()=>e(s).action==="set",f=>{var u=Ve();const o=qe(()=>he(e(s)));var w=pe(u);Q(w,()=>e(o),I=>{var Ee=ft(),Oe=l(a(Ee),2),Ue=a(Oe);Q(Ue,()=>e(o).type==="range",De=>{var re=pt(),g=pe(re);X(g);var se=l(g,2),Se=a(se);t(se),_(()=>{G(g,"min",e(o).min),G(g,"max",e(o).max),G(g,"step",e(o).step),x(Se,`${(e(s).value||0)??""}${e(o).unit??""}`)}),ie(g,()=>e(s).value,$e=>(e(s).value=$e,S(()=>i().actions))),p(De,re)},De=>{var re=bt(),g=pe(re);X(g);var se=l(g,2),Se=a(se);t(se),_(()=>{G(g,"min",e(o).min),G(g,"max",e(o).max),G(g,"step",e(o).step),x(Se,e(o).unit)}),ie(g,()=>e(s).value,$e=>(e(s).value=$e,S(()=>i().actions))),p(De,re)}),t(Oe),t(Ee),p(I,Ee)}),p(f,u)}),t(E);var Te=l(E,2),Ie=a(Te);at(Ie,{class:"h-5 w-5"}),t(Te),t(c),Ce(N,()=>e(s).type,f=>(e(s).type=f,S(()=>i().actions))),Ce(D,()=>e(s).target,f=>(e(s).target=f,S(()=>i().actions))),Ce(Ae,()=>e(s).action,f=>(e(s).action=f,S(()=>i().actions))),T("click",Te,()=>ge(k)),p(n,c)}),t(ee);var te=l(ee,2),ae=a(te),ue=l(ae,2),ce=a(ue);t(ue),t(te),t(de),t(z),t(Z),t(V),_(()=>{x(W,`${(i().id?"Edit":"Create")??""} Automation`),x(ce,`${(i().id?"Update":"Create")??""} Automation`)}),T("click",F,()=>$("cancel")),ie(r,()=>i().name,n=>i(i().name=n,!0)),ie(P,()=>i().description,n=>i(i().description=n,!0)),ie(B,()=>i().trigger.time,n=>i(i().trigger.time=n,!0)),T("click",L,j),T("click",ae,()=>$("cancel")),T("submit",z,We(ye)),p(be,V),Me()}var yt=y('<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Demo Mode</span>'),ht=y('<div class="bg-white shadow rounded-lg"><div class="px-4 py-5 sm:p-6"><div class="flex items-start justify-between"><div class="flex-1"><h3 class="text-lg font-medium text-gray-900"> </h3> <p class="mt-1 text-sm text-gray-500"> </p> <div class="mt-4 flex items-center space-x-4 text-sm text-gray-500"><div class="flex items-center"><!> <!></div> <div class="flex items-center"><!> </div></div></div> <div class="flex items-center space-x-2"><button class="p-2 rounded-full hover:bg-gray-100"><!></button> <button class="p-2 rounded-full hover:bg-gray-100"><!></button> <button class="p-2 rounded-full hover:bg-gray-100"><!></button></div></div></div></div>'),wt=y('<div class="space-y-6"><div class="flex justify-between items-center"><h1 class="text-2xl font-bold text-gray-900">Automations</h1> <!></div> <div class="flex justify-end"><button class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"><!> Create Automation</button></div> <div class="grid grid-cols-1 gap-6"></div></div> <!>',1);function Vt(be,U){Fe(U,!1);const fe=Xe(),i=()=>Ge(Ke,"$isDemoMode",fe),v=me(),$=me();let oe=je(U,"data",8),C=me(!1),j=me(null);function ge(){m(j,{name:"",description:"",isEnabled:!0,trigger:{type:"schedule",time:"12:00",days:[]},actions:[]}),m(C,!0)}function _e(d){m(j,{...d}),m(C,!0)}async function xe(d){if(i())m(v,e(v).map(r=>r.id===d.id?{...r,isEnabled:!r.isEnabled}:r));else try{if(!(await fetch(`/api/automations/${d.id}/toggle`,{method:"POST"})).ok)throw new Error("Failed to toggle automation")}catch(r){console.error("Error toggling automation:",r)}}async function ye(d){if(confirm("Are you sure you want to delete this automation?"))if(i())m(v,e(v).filter(r=>r.id!==d.id));else try{if(!(await fetch(`/api/automations/${d.id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete automation")}catch(r){console.error("Error deleting automation:",r)}}async function he(d){const r=d.detail;if(i())r.id?m(v,e(v).map(b=>b.id===r.id?r:b)):(r.id=(e(v).length+1).toString(),m(v,[...e(v),r]));else try{const b=r.id?`/api/automations/${r.id}`:"/api/automations",P=r.id?"PUT":"POST";if(!(await fetch(b,{method:P,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Failed to save automation")}catch(b){console.error("Error saving automation:",b)}m(C,!1),m(j,null)}ze(()=>(e(v),e($),He(oe())),()=>{(d=>(m(v,d.automations),m($,d.availableDevices)))(oe())}),Be(),Le();var V=wt(),Z=pe(V),O=a(Z),R=l(a(O),2);Q(R,i,d=>{var r=yt();p(d,r)}),t(O);var W=l(O,2),F=a(W),we=a(F);rt(we,{class:"h-5 w-5 mr-2"}),Pe(),t(F),t(W);var z=l(W,2);K(z,5,()=>e(v),d=>d.id,(d,r)=>{var b=ht(),P=a(b),M=a(P),q=a(M),B=a(q),ne=a(B);t(B);var H=l(B,2),de=a(H);t(H);var J=l(H,2),L=a(J),ve=a(L);st(ve,{class:"h-4 w-4 mr-1"});var ee=l(ve,2);Q(ee,()=>e(r).trigger.type==="schedule",A=>{var D=Ze();_(()=>x(D,`${e(r).trigger.time??""},
                    ${(e(r).trigger.days.length===7?"Every day":e(r).trigger.days.join(", "))??""}`)),p(A,D)}),t(L);var te=l(L,2),ae=a(te);ot(ae,{class:"h-4 w-4 mr-1"});var ue=l(ae);t(te),t(J),t(q);var ce=l(q,2),n=a(ce),s=a(n),k=qe(()=>`h-5 w-5 ${(e(r).isEnabled?"text-green-600":"text-gray-400")??""}`);Je(s,()=>e(r).isEnabled?lt:it,(A,D)=>{D(A,{get class(){return e(k)}})}),t(n);var c=l(n,2),E=a(c);nt(E,{class:"h-5 w-5 text-gray-400"}),t(c);var h=l(c,2),N=a(h);dt(N,{class:"h-5 w-5 text-red-400"}),t(h),t(ce),t(M),t(P),t(b),_(()=>{x(ne,e(r).name),x(de,e(r).description),x(ue,` ${e(r).actions.length??""} action${(e(r).actions.length===1?"":"s")??""}`)}),T("click",n,()=>xe(e(r))),T("click",c,()=>_e(e(r))),T("click",h,()=>ye(e(r))),p(d,b)}),t(z),t(Z);var Y=l(Z,2);Q(Y,()=>e(C),d=>{xt(d,{get automation(){return e(j)},get availableDevices(){return e($)},$$events:{save:he,cancel:()=>{m(C,!1),m(j,null)}}})}),T("click",F,ge),p(be,V),Me()}export{Vt as component};
